```{r, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = FALSE)
```

```{r, echo = FALSE}
library(here)
library(tidyverse)
library(lme4)
library(sjPlot)
# load participants 
participants <- read.csv(here::here("data", "tidy", "participant_count.csv"))

# load data 
l1_df <- read.csv(here::here("data", "tidy", "non_l2_subset.csv"))
l2_df <- read.csv(here::here("data", "tidy", "l2_subset.csv"))
tidy_df <- rbind(l1_df, l2_df)
all_desc_df <- read.csv(here("data", "tidy", "all_desc.csv"))

# load models
mod0 <- readRDS(here("data", "models", "full_model.RDS"))
model1 <- readRDS(here("data", "models", "l2_sub_model.RDS"))
model2 <- readRDS(here("data", "models", "l1_sub_model.RDS"))

# load nested model comps 
nmc_f <- read.csv(here("data", "tidy", "nmc_full.csv"))
nmc_l1 <- read.csv(here("data", "tidy", "nmc_l1.csv"))
nmc_l2 <- read.csv(here("data", "tidy", "nmc_l2.csv"))

# load r_squared df 
r_dq_df <- read.csv(here("data", "tidy", "r_sq_df.csv"))

fm_2rm <- r_dq_df$R2m[1] %>% round(digits = 3)*100 # model full r2m
l2_r2m <- r_dq_df$R2m[2] %>% round(digits = 3)*100 # model l2 r2m
l1_r2m <- r_dq_df$R2m[3] %>% round(digits = 3)*100 # model l1 r2m

fm_2rc <- r_dq_df$R2c[1] %>% round(digits = 3)*100 # model full r2c
l2_r2c <- r_dq_df$R2c[2] %>% round(digits = 3)*100 # model l2 r2c
l1_r2c <- r_dq_df$R2c[3] %>% round(digits = 3)*100 # model l1 r2c

# make fixed effects a df 
mod0_fix_ef <- fixef(mod0) %>% 
  as.data.frame() # full df 

mod1_fix_ef <- fixef(model1) %>% 
  as.data.frame() # L2 subset 
 
mod2_fix_ef <- fixef(model2) %>% 
  as.data.frame() # L1 subset 


# full model effects 
full_fr <- mod0_fix_ef$.[2] %>% round(digit = 2) # fr
full_sp <- mod0_fix_ef$.[3] %>% round(digit = 2) # sp

# l2 effects 
l2_fr <- mod1_fix_ef$.[2] %>% round(digit = 2) # fr
l2_sp <- mod1_fix_ef$.[3] %>% round(digit = 2) # sp

# l1 effects 
l1_fr <- mod2_fix_ef$.[2] %>% round(digit = 2) # fr
l1_sp <- mod2_fix_ef$.[3] %>% round(digit = 2) # sp

participants <- read.csv(here::here("data", "tidy", "participant_count.csv"))
total_participants <- sum(participants$l2_subset_no, participants$non_l2_no, participants$dqed_no)

total_participants_q <- sum(participants$l2_subset_no, participants$non_l2_no)

stim_df <- read.csv(here("data", "tidy", "stim.csv"))


```
# Methods

## Participants
 
A total of `r total_participants` participants were recruited for the present study.
Two groups of participants were recruited, consisting of an experimental group and a control group. After exclusion of some participants, the experimental group consisted of 36 Mexican Spanish-English bilinguals and the control group consisted of 30 Spanish monolinguals. 
Bilinguals were excluded if they did not produce distinct relative VOT in their L1 and their L2 (n = `r participants$dqed_no`), or answered 'yes' to the question 'do you speak a third language?'. 
The experimental group consisted on late bilinguals who acquired their L2 English at an average age of (X, sd = x) and their average proficiency in English was (X, sd = x) on self-rated scale of 7.

```{r}
# participants desc 
# get data from labvanced 
```

## Materials

Three total tasks were used to elicit VOT production. 
A shadowing task was used to gather French relative VOT, in which participants heard a recording of French words in isolation and repeated those words. 
In English and Spanish, elicited production tasks were used. These tasks presented a single stimulus on the screen and participants recorded themselves reading the word aloud.

To gather background information and to measure proficiency, a brief language questionnaire was given to participants.
Participants were asked their country of residence and of origin, whether they spoke a third language, whether they spoke a second language, and their self-rated proficiency on a scale from 1 to 7, with 7 being the highest possible score and 1 being the lowest possible score. 

The stimuli were words with word initial stops of either one or two syllables, with stress on the initial syllable (see table **X**).
The French words were produced by a French native speaker and were produced with Spanish-like relative VOT (Mean VOT = `r mean(stim_df$relative_vot) %>% round(digits = 3)`, sd = `r sd(stim_df$relative_vot) %>% round(digits = 3)`).

 
## Procedure

The elicited production task and shadowing task were programmed in Labvanced, a browser based software designed for online research. All tasks were given in one session. 
The order of the languages was counterbalanced and the stimulus order was randomized with each language specific block. 
The questionnaire was given at the beginning of the tasks.

## Statistical Analyses

Sample size was determined by carrying out a power analysis, in which a small sample of pilot data was used to determine an appropriate sample for within-subjects tests of equivalence where the equivalence bounds were -.4 and .4 standard deviations from the mean, alpha was .05, and power was .8. 

To determine the relative effect for language, the production data were analyzed using generalized linear mixed effects models in which relative VOT was modeled as a function of language (French, Spanish, English and consonant (p, t, k). 
Relative VOT was converted to z-scores in each language. For each model, subjects and words (item) were random intercepts. 
The residuals were determined to be normal by visual inspection of a Q-Q plot and a residuals versus fits plot. 
In order to determine the individual contribution of each fixed effect predictor and to derive main effects, nested model comparisons were carried out. 
These nested model comparisons began with an intercept-only model and added the fixed effect predictors of language and consonant one at a time. 

To test for practical equivalence, participant mean relative VOT per language were utilized to carry out paired tests of equivalence (TOST; Lakens, 2017). 
The equivalence bounds were set to -.4 and .4 standard deviations from the mean respectively, a small effect size reported in L2 literature (Plonsky & Oswald, 2014).

Finally, initial and post-hoc t-tests were used for inclusion and subsetting procedures. 
The initial t-tests were run per participant to determine whether their was a difference between Spanish and English relative VOT. 
The post-hoc t-tests were used as a method of subsetting the data into subgroups in which participants showed greater influence of either L1 or L2 on L3 productions.  

# Results 

Table **X** lists the mean values of the pooled relative per language, and table **X** lists the value per consonant in each language. 


```{r}
#| echo = FALSE, fig.width = 10,
#| fig.cap = "This is a long caption."

tidy_df %>% 
  group_by(language, text) %>% 
  summarise(`Relative VOT` = mean(relative_vot), `SD` = sd(relative_vot)) %>% 
  filter(text == "k") %>% 
  knitr::kable(digits = 3)
```

```{r}
tidy_df %>% 
  group_by(language, text) %>% 
  summarise(`Relative VOT` = mean(relative_vot), `SD` = sd(relative_vot)) %>% 
  filter(text == "t") %>% 
  knitr::kable(digits = 3)
```

```{r}
tidy_df %>% 
  group_by(language, text) %>% 
  summarise(`Relative VOT` = mean(relative_vot), `SD` = sd(relative_vot)) %>% 
  filter(text == "p") %>% 
  knitr::kable(digits = 3)
```

```{r}
tidy_df %>% 
  group_by(language) %>% 
  summarise(`Relative VOT` = mean(relative_vot), `SD` = sd(relative_vot)) %>% 
  rename("Language" = language) %>% 
  knitr::kable(digits = 3)
```

Figure X plots relative VOT as a function of language. An inspection of the boxplot suggests that French relative VOT falls between that of English and Spanish. 

```{r, res=600}
tidy_df %>% 
  ggplot(aes(x = relative_vot, y = language)) + geom_boxplot() + xlim(0,.3)
```

Nested model comparisons revealed a main effect for both *language* (χ(`r nmc_f$Df[2]`) = `r nmc_f$Chisq[2] %>% round(digits = 2)`; p < .001) and *consonant* (
χ(`r nmc_f$Df[3]`) = `r nmc_f$Chisq[3] %>% round(digits = 2)`; p < .001). No main effect was found for the language x consonant interaction. Overall, the best-fitting model explained `r fm_2rm`% of the variance observed with fixed effect predictors (marginal R squared), and `r fm_2rc`% of the variance in the data with the added random effects (conditional R squared). The parameter estimates of the best fitting model suggest, with the effect of consonant held constant and English as the baseline, relative VOT increases by `r full_sp` standard deviations in the case of Spanish and `r full_fr` standard deviations in the case of French. These parameter estimates, coupled with the visual information provided by the boxplots, suggest that, overall, French productions fall between those of Spanish and English. The full output of the model can be seen in figure **X**

```{r}
tab_model(mod0)
```

Figure **X** shows the results of the paired test of equivalence between French and English productions. As one can see, the result of the null hypothesis significance test (a t-test) corroborates the output of the linear model and suggests that English and French relative VOT productions are distinct. As a result, the samples were not determined to be equivalent. 

```{r}
# tost of full dataset
tidy_df_fr <- tidy_df %>% 
  filter(language == "french")

tidy_df_en <- tidy_df %>% 
  filter(language == "english")

TOSTER::TOSTtwo(m1 = mean(tidy_df_fr$relative_vot),
                m2 = mean(tidy_df_en$relative_vot),
                sd1 = sd(tidy_df_fr$relative_vot),
                sd2 = sd(tidy_df_en$relative_vot),
                n1 = length(unique(tidy_df_fr$participant)),
                n2 = length(unique(tidy_df_fr$participant)),
                low_eqbound_d = -.4,
                high_eqbound_d = .4)
```

# Interim discussion

The results of the GLMM and the TOST do not provide support for the prediction that the L3 would be produced in an L2-like fashion. On the contrary, the results of these analyses show that French relative VOT falls between L1 Spanish and L2 English relative VOT. However, these analyses alone do not make clear whether individual variation is the cause of the group trend, or whether most participants display intermediate relative VOT. In the context of L3 models, the TPM and the L2SF would not expect hybrid values to occur, where models such as the LPM and Scalpel model can account for these results. 

In order to better evaluate whether co-activation of L1 and L2 or activation of a single language is occurring, the full dataset was subset into primary L1 and L2 influence post-hoc. Participants were divided into groups based on their individual French-English t.test results. When a difference between French and English was detected (p < .05, n = `r participants$non_l2_no`), participants were placed in the L1-influence subset, where when no difference between French and English was detected (p > .05, n = `r participants$l2_subset_no`), they were placed in the L2 influence group. The same statistical tests, including generalized linear mixed effects models and tests of equivalence, were used to analyze the data subsets in the same manner as the full dataset. 

## Post-hoc results 

TOSTs revealed that the L1 Spanish t(239.88) = -2.458, p = 0.00733 and L2 English (t(309.9) = -2.832, p = 0.00246) productions were produced practically equivalently between the subsets.

### L2 subset model 

```{r}
l2_df %>% 
  group_by(language) %>% 
  summarise(`Relative VOT` = mean(relative_vot), `SD` = sd(relative_vot)) %>% 
  rename("Language" = language) %>% 
  knitr::kable(digits = 3)
```

The L2 subset model is plotted in figure X. Relative to the full dataset model (figure X), the French values appear to be more heavily influenced by the L2. Like the full dataset, nested model comparisons revealed a main effect for both *language* (χ(`r nmc_l2$Df[2]`) = `r nmc_l2$Chisq[2] %>% round(digits = 2)`; p < .001) and *consonant* (χ(`r nmc_l2$Df[3]`) = `r nmc_l2$Chisq[3] %>% round(digits = 2)`; p < .001). The parameter estimates of the model revealed a smaller effect for language for French  `r l2_fr` relative to English than the full dataset model (`r full_fr`). The effect for Spanish was similar `r l2_sp` (full model `r full_fr`). The full L2 subset model can be seen in table X. 

```{r, res=600}
l2_df %>% 
  ggplot(aes(x = relative_vot, y = language)) + geom_boxplot() + xlim(0,.3) + ggtitle("L2 subset")
```

```{r}
tab_model(model1)
```

```{r}
# L2 sub eng-fren tost 
l2_subset_df <- l2_df
l2_subset_df_fr <- l2_subset_df %>% 
  filter(language == "french")
l2_subset_df_en <- l2_subset_df %>% 
  filter(language == "english")

# TOST to see whether a subset of participants are practically equivalent with
# eng and french 

TOSTER::TOSTpaired(n = length(unique(l2_subset_df$participant)), 
                   m1 = mean(l2_subset_df_fr$relative_vot), 
                   m2 = mean(l2_subset_df_en$relative_vot), 
                   sd1 = sd(l2_subset_df_fr$relative_vot), 
                   sd2 = sd(l2_subset_df_en$relative_vot),
                   r12 = .44, # use mean df to find cor 
                   low_eqbound_dz = -.4, 
                   high_eqbound_dz = .4)


```

### L1 subset model 

```{r}
l1_df %>% 
  group_by(language) %>% 
  summarise(`Relative VOT` = mean(relative_vot), `SD` = sd(relative_vot)) %>% 
  rename("Language" = language) %>% 
  knitr::kable(digits = 3)
```

The L1 subset model is plotted in figure X. Relative to the full dataset model (figure X), the French values appear to be closely resemble the L1 values. Nested model comparisons found that the best fitting model was the same as the full data model and the L2 subset model, in which there was a main effect for both *language* (χ(`r nmc_l1$Df[2]`) = `r nmc_l1$Chisq[2] %>% round(digits = 2)`; p < .001) and *consonant* (χ(`r nmc_l1$Df[3]`) = `r nmc_l1$Chisq[3] %>% round(digits = 2)`; p < .001). The parameter estimates of the L1 subset model revealed similar effects of language relative to English(French: `r l1_fr`, Spanish: `r l1_sp`)

The parameter estimates of the model revealed a larger effect for language for French  `r l1_fr` relative to English than the full dataset model (`r full_fr`). The effect for Spanish was similar `r l1_sp` (full model `r full_sp`). The full L2 subset model can be seen in table X. 

```{r, res=600}
l1_df %>% 
  ggplot(aes(x = relative_vot, y = language)) + geom_boxplot() + xlim(0,.3) + ggtitle("L1 subset")
```

```{r}
tab_model(model2)
```

```{r}
# L1 sub Span-fren tost 
non_l2_subset_df_fr <- l1_df %>% 
  filter(language == "french")
non_l2_subset_df_sp <- l1_df %>% 
  filter(language == "spanish")

TOSTER::TOSTpaired(n = length(unique(l1_df$participant)), 
                   m1 = mean(non_l2_subset_df_fr$relative_vot), 
                   m2 = mean(non_l2_subset_df_sp$relative_vot), 
                   sd1 = sd(non_l2_subset_df_fr$relative_vot), 
                   sd2 = sd(non_l2_subset_df_sp$relative_vot),
                   r12 = .44, # use mean df to find cor - change to nonpaired
                   low_eqbound_dz = -.4, 
                   high_eqbound_dz = .4)
```

# Discussion 

A post-hoc power analysis of the difference between all language pairs was X for English-Spanish, X for Spanish-French and X for English-French. 
These result imply that the need for a sufficiently powered sample size met was met, and that the results obtained here are likely not due to sampling error. At the same time, the L1 subset participants did not have a sufficient sample size to provide evidence for practical equivalence on a Test of Equivalence (TOST; Lakens, 2017). 
Given that these two trends of L1 or L2 influence on L3 productions, and their different degrees of influence, was not predicted, the present study did not have in mind potential subsets during the initial recruitment procedure. 
Future studies on absolute beginners to an L3 could benefit from even larger sample sizes (n > 200), coupled with a rich background questionnaire, in order to be able to robustly examine whether L1 groups are fully influenced by the L1, and to explore plausible correlations between linguistic background and choice of language in L3 productions. 

The present data suggest that L3 learners at first exposure may 'choose' one language to primarily influence their L3, but that this primary influence could be simultaneously influenced by both the phonetics of the input or L1 influence. 
The present data cannot tease apart this difference, since the L1 of these participants, Spanish, and the L3, French, are both true-voicing language. 
It is reasonable, however, to conclude that the presence of aspiration in L3 productions of these participants is due to L2 influence, since their L2, English, is an aspirating language, and these participants also aspirated in their L2 in the English EPT.
 
The present data are best explained by two L3 models, depending upon which subset is examined. 
The full data set and the L2 subset are best explained the the Linguistic Proximity Model. 
The hybrid values observed here could be explained by the LPM's notion of L3 learning as co-activation of linguistic systems. 
In the case of the L1 subset, the Typological Primacy Model and the LPM both may account for the results obtained, since it appears that L1 influence is rather strong, and the degree of potential L2 influence in the L1 subset seems to be negligible. 
An issue with the L1 subset supporting the LPM is that it does not corroborate a specific prediction by the model and as such is not falsifiable, as scholars have argued. 
Unlike the TPM, the LPM makes fewer restrictive predictions of L3 behavior and allows for "Full Transfer Potential", suggesting that either of the two previously acquired linguistic systems may fully transfer on a property-by-property basis, or simultaneously influence a single property. 
However, it is unclear why one language may influence L3 productions over another.
In this case, clear L2 influence is seen in the complete dataset and within the L2 subset. 
This influence is not facilitative, since the L3 in Spanish-like in terms of VOT, and points to L2 status effects. 
However, it is unclear why the L1 subset group demonstrated target-like relative VOT in the L3.
It is possible that these participants were simply more proficient mimics of the acoustic stimuli. 
On the other hand, it is also possible that these participants were metalinguistically guided by knowledge that Spanish and French are historically similar languages. 
In order to evaluate whether the L1 subset was influenced more by the phonetics of the stimuli or L1 influence, a future study could involve a second L3 group which is given an aspirating L3 to shadow (such as German).
Then, if participants were to aspirate in the L2 but not the L3, despite the fact that the stimuli would be aspirated, then evidence for L1 influence could be provided.


The present study did not lack limitations. 
Firstly, the participants completed a short background questionnaire, since individual differences were not included in the study's original predictions. The lack of this information about linguistic background did not allow for an exploratory post-hoc analysis of the subset data.
Second, the self-rated proficiency could have been corroborated with a standard proficiency measure such as the LexTALE in order to provide more comprehensive background of language proficiency that could be used in further post-hoc exploratory analysis. 
Finally, the present data were exclusively collected online. Online data collection presents many challenges and limitations. Specifically, it was not possible to control for the environment of the participants in terms of ambient noise in their perception and production of the French stimuli. Additionally, variable audio recording devices and speakers were used by participants. 
As a result, it cannot be ruled out that the present data could have been influenced by differences in audio quality produced by participants' equipment in both perception and production. 



```{r, include=FALSE} 
all_desc_df %>% # effect sizes - add if there is room
  knitr::kable(digits = 3, caption = "Effect sizes of each subset per language pairing")
```


```{r, fig.height = 7, fig.width = 12, include=FALSE}
all_desc_df %>% # effect sizes - add if there is room
  ggplot(aes(x = eff_size, y = set, shape = pair)) + geom_point(aes(shape = pair, pch = 21, size = 4, fill = "white", colour = "black")) +
  geom_linerange(aes(xmin = ci_low, xmax = ci_hi)) +
  geom_vline(xintercept = 0) + geom_vline(xintercept = .4, linetype = "dashed", alpha = .5) +
  geom_vline(xintercept = -.4, linetype = "dashed", alpha = .5) +
  geom_rect(aes(xmin = -.4, xmax = .4, ymin = 0, ymax = 5),
            alpha = .05) +
    geom_rect(aes(xmin = -.7, xmax = .7, ymin = 0, ymax = 5),
            alpha = .025) +
    geom_rect(aes(xmin = -1, xmax = 1, ymin = 0, ymax = 5), 
            alpha = .01) +
  ggtitle("Effect sizes per dataset and language pairing") 

```

```{r, include = FALSE}
all_desc_df %>% # effect sizes - add if there is room
  ggplot(aes(x = eff_size, y = set, color = pair)) + geom_point() +
  geom_linerange(aes(xmin = ci_low, xmax = ci_hi)) + 
  geom_tile(aes(width = -.4 - .4),
            alpha = 0.2, height = Inf, fill = "#31688EFF")
```

# Conclusion 

The present study examined the production of relative VOT of L3 French at first exposure by Mexican Spanish-English late bilinguals. 
The findings suggest that individual variability exists in the first productions of a third language in which speakers appear to be influenced by L1 and L2 phonology simultaneously. 
At the same time, the degree of language-specific influence was not equal; a subset of the full dataset showed quite heavy L1 influence (EFF SIZE) on L3 French production, where the L2 subset group produced hybrid values. 

These findings replicated the findings in the literature which reported intermediate or hybrid VOT values in trilinguals and provides further evidence that both languages of a bilingual are active during L3 learning. 
At the same time, the degree of co-activation seems to vary widely.
The present study may orient future research so that it may include groups which examine distinct L3 stimuli to better examine how the phonetics of the input interact with L2 status effects. 

Additionally, the present study was the first to use a test of equivalence in L3 research.
This statistical method may provide more precise insights as to whether the claims in the literature that L3 groups or within-subjects comparisons are actually equivalent. 
Future research should consider this method, rather than the use of a lack of a main effect or insignificant t-test as evidence for practical equivalence. 
