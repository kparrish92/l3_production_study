#  warmup = 1000, iter = 2000, chains = 4, cores = 4)
#mcmc_plot(span_mod_p)
#p_fixef = fixef(span_mod_p) %>%
#  as.data.frame()
#span_df_p %>%
#  ggplot(aes(y = vot, x = text)) +
#  geom_point(position = position_dodge(width = .5)) +
#  geom_pointrange(aes(y = p_fixef$Estimate,
#                      ymax = p_fixef$Q97.5,
#                      ymin = p_fixef$Q2.5), color = "blue")
k = 1000
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 7, ncol = 5)
sizes = c(3,5,8,10,12,15,20)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
power_df_per_size %>%
as.data.frame()
power_df_per_size %>%
as.data.frame() %>%
rename(V1 = "Samples")
power_df_per_size %>%
as.data.frame() %>%
rename("Samples" = V1)
power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min" = V4) %>%
rename("max" = V5)
mean(span_df_p)
mean(span_df_p$vot_ms)
library(tidyverse)
library(here)
library(brms)
l2_df <- read.csv(here::here("data", "tidy", "l2_subset.csv"))
l1_df <- read.csv(here::here("data", "tidy", "non_l2_subset.csv"))
all_df <- rbind(l1_df, l2_df)
all_df %>%
group_by(text, language) %>%
summarize(mean_vot = mean(vot),
sd_vot = sd(vot),
min_vot = min(vot),
max_vot = max(vot))
# Fit model to get credible interval for plotting
span_df_p = all_df %>% filter(language == "spanish") %>%
filter(text == "p")
#span_mod_p <- brm(
#  vot ~ 1, data = sample_df,
#  warmup = 1000, iter = 2000, chains = 4, cores = 4)
#mcmc_plot(span_mod_p)
#p_fixef = fixef(span_mod_p) %>%
#  as.data.frame()
#span_df_p %>%
#  ggplot(aes(y = vot, x = text)) +
#  geom_point(position = position_dodge(width = .5)) +
#  geom_pointrange(aes(y = p_fixef$Estimate,
#                      ymax = p_fixef$Q97.5,
#                      ymin = p_fixef$Q2.5), color = "blue")
k = 1000
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 9, ncol = 5)
sizes = c(3,5,8,10,12,15,20,25,80)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min" = V4) %>%
rename("max" = V5)
mean(span_df_p$vot_ms)
sizes = c(3,5,8,10,12,
15,20,25,30,
40,50,80)
k = 1000
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 12, ncol = 5)
sizes = c(3,5,8,10,12,
15,20,25,30,
40,50,80)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min" = V4) %>%
rename("max" = V5)
mean(span_df_p$vot_ms)
plot_df = power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min" = V4) %>%
rename("max" = V5)
plot_df %>%
ggplot(aes(x = samples, y = mean, color = power))
plot_df %>%
ggplot(aes(x = samples, y = mean, color = power)) +
geom_pointrange(xmin = min, xmax = max)
plot_df %>%
ggplot(aes(x = samples, y = mean, color = power)) +
geom_pointrange(xmin = min, xmax = max)
plot_df = power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min_mean" = V4) %>%
rename("max_mean" = V5)
mean(span_df_p$vot_ms)
plot_df %>%
ggplot(aes(x = samples, y = mean, color = power)) +
geom_pointrange(xmin = min_mean, xmax = max_mean)
plot_df %>%
ggplot(aes(x = samples, y = mean, color = power)) +
geom_pointrange(ymin = min_mean, ymax = max_mean)
plot_df %>%
ggplot(aes(x = samples, y = mean, color = power)) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean))
plot_df %>%
ggplot(aes(x = as.factor(samples), y = mean, color = power)) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean))
mean(span_df_p$vot_ms)
range(span_df_p$vot_ms)
View(plot_df)
dataframe = all_df
segment = "p"
iterations = 1000
power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min_mean" = V4) %>%
rename("max_mean" = V5)
vot_tokens_needed = function(dataframe, segment, iterations)
{
span_df_p = df %>% filter(language == "spanish") %>%
filter(text == "p")
k = 1000
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 12, ncol = 5)
sizes = c(3,5,8,10,12,
15,20,25,30,
40,50,80)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
plot_df = power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min_mean" = V4) %>%
rename("max_mean" = V5)
return(plot_df)
}
vot_tokens_needed(dataframe, segment, iterations)
dataframe = all_df
segment = "p"
iterations = 1000
vot_tokens_needed(dataframe, segment, iterations)
span_df_p = df %>% filter(language == "spanish") %>%
filter(text == "p")
vot_tokens_needed = function(dataframe, segment, iterations)
{
span_df_p = dataframe %>% filter(language == "spanish") %>%
filter(text == "p")
k = 1000
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 12, ncol = 5)
sizes = c(3,5,8,10,12,
15,20,25,30,
40,50,80)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
plot_df = power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min_mean" = V4) %>%
rename("max_mean" = V5)
return(plot_df)
}
vot_tokens_needed(dataframe, segment, iterations)
vot_tokens_needed = function(dataframe, segment, iterations)
{
span_df_p = dataframe %>% filter(language == "spanish") %>%
filter(text == segment)
#set.seed()
k = iterations
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 12, ncol = 5)
sizes = c(3,5,8,10,12,
15,20,25,30,
40,50,80)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
plot_df = power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min_mean" = V4) %>%
rename("max_mean" = V5)
return(plot_df)
}
vot_tokens_needed(dataframe, segment, iterations)
vot_tokens_needed(all_df, "p", 1000)
span_df = all_df %>% filter(language == "spanish")
p_df = vot_tokens_needed(span_df, "p", 1000) %>%
mutate(segment = "p")
View(p_df)
k_df = vot_tokens_needed(all_df, "k", 1000) %>%
mutate(segment = "k")
t_df = vot_tokens_needed(all_df, "t", 1000) %>%
mutate(segment = "t")
View(t_df)
View(k_df)
plot_df %>%
ggplot(aes(x = as.factor(samples), y = mean, color = power)) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean))
all_df %>%
group_by(text, language) %>%
summarize(mean_vot = mean(vot),
sd_vot = sd(vot),
min_vot = min(vot),
max_vot = max(vot))
plot_df_all = rbind(p_df, t_df, k_df)
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = power)) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean))
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = power)) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment)
View(plot_df_all)
plot_df_all = rbind(p_df, t_df, k_df) %>%
mutate(power_color = case_when(power < 20 ~ 1),
power_color = case_when(power > 20 ~ 0))
View(plot_df_all)
plot_df_all = rbind(p_df, t_df, k_df) %>%
mutate(power_color = case_when(power < 20 ~ 1,
power > 20 ~ 0))
View(plot_df_all)
plot_df_all = rbind(p_df, t_df, k_df) %>%
mutate(power_color = case_when(power =< 20 ~ 1,
power > 20 ~ 0))
plot_df_all = rbind(p_df, t_df, k_df) %>%
mutate(power_color = case_when(power <= 20 ~ 1,
power > 20 ~ 0))
View(plot_df_all)
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = power_color)) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment)
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = as.factor(power_color))) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment)
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = as.factor(power_color))) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment) + ggtitle("Spanish VOT per group")
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = as.factor(power_color))) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment) + ggtitle("Spanish VOT per segment by L1 speakers")
p_df = vot_tokens_needed(span_df, "p", 1000) %>%
mutate(segment = "p")
k_df = vot_tokens_needed(span_df, "k", 1000) %>%
mutate(segment = "k")
t_df = vot_tokens_needed(span_df, "t", 1000) %>%
mutate(segment = "t")
plot_df_all = rbind(p_df, t_df, k_df) %>%
mutate(power_color = case_when(power <= 20 ~ 1,
power > 20 ~ 0))
all_df %>%
group_by(text, language) %>%
summarize(mean_vot = mean(vot),
sd_vot = sd(vot),
min_vot = min(vot),
max_vot = max(vot))
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = as.factor(power_color))) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment) + ggtitle("Spanish VOT per segment by L1 speakers")
vot_tokens_needed = function(dataframe, segment, iterations)
{
span_df_p = dataframe %>% filter(language == "english") %>%
filter(text == segment)
#set.seed()
k = iterations
power_df = matrix(nrow = k, ncol = 2)
power_df_per_size = matrix(nrow = 12, ncol = 5)
sizes = c(3,5,8,10,12,
15,20,25,30,
40,50,80)
for(thisSize in 1:nrow(power_df_per_size)){
for (thisRun in 1:k) {
sample_df = span_df_p %>%
sample_n(sizes[thisSize])
t_df = t.test(sample_df$vot_ms, span_df_p$vot_ms)
power_df[thisRun, 1] = t_df$p.value
power_df[thisRun, 2] = mean(sample_df$vot_ms)
}
power_df_per_size[thisSize, 1] = sizes[thisSize]
power_df_per_size[thisSize, 2] = sum(power_df[,1] < .05)
power_df_per_size[thisSize, 3] = mean(power_df[,2])
power_df_per_size[thisSize, 4] = min(power_df[,2])
power_df_per_size[thisSize, 5] = max(power_df[,2])
}
plot_df = power_df_per_size %>%
as.data.frame() %>%
rename("samples" = V1) %>%
rename("power" = V2) %>%
rename("mean" = V3) %>%
rename("min_mean" = V4) %>%
rename("max_mean" = V5)
return(plot_df)
}
p_df = vot_tokens_needed(span_df, "p", 1000) %>%
mutate(segment = "p")
k_df = vot_tokens_needed(span_df, "k", 1000) %>%
mutate(segment = "k")
t_df = vot_tokens_needed(span_df, "t", 1000) %>%
mutate(segment = "t")
plot_df_all = rbind(p_df, t_df, k_df) %>%
mutate(power_color = case_when(power <= 20 ~ 1,
power > 20 ~ 0))
all_df %>%
group_by(text, language) %>%
summarize(mean_vot = mean(vot),
sd_vot = sd(vot),
min_vot = min(vot),
max_vot = max(vot))
plot_df_all %>%
ggplot(aes(x = as.factor(samples), y = mean, color = as.factor(power_color))) +
geom_pointrange(aes(ymin = min_mean, ymax = max_mean)) +
facet_wrap(~segment) + ggtitle("Spanish VOT per segment by L1 speakers")
source(here::here("scripts", "00_libs.R"))
source(here("scripts", "01_helpers.R"))
# -----------------------------------------------------------------------------
# after autosegmentation is done, tidy the textgrid data
mono_bio <- read.csv(here("data", "tidy", "completed_mono.csv"))
# load all  all Textgrid files under "participant_uploads"
list_of_files <- list.files(path = here("data", "participant_uploads"), recursive = TRUE,
pattern = "\\.TextGrid$",
full.names = TRUE) %>%
as.data.frame()
df2 <- character()
for (iteration in 1:nrow(list_of_files)) {
df <- read_textgrid(list_of_files$.[iteration]) %>%
add_words() %>%
mutate(file = list_of_files$.[iteration])
df2 <- rbind(df, df2)
}
View(df2)
# Source libs -----------------------------------------------------------------
# data used in slides and manuscripts
source(here::here("scripts", "00_libs.R"))
source(here("scripts", "01_helpers.R"))
participants <- read.csv(here::here("data", "tidy", "participant_count.csv"))
l2_df <- read.csv(here::here("data", "tidy", "l2_subset.csv"))
l1_df <- read.csv(here::here("data", "tidy", "non_l2_subset.csv"))
# load models
mod0 <- readRDS(here("data", "models", "full_model.RDS"))
l1_mod <- read_rds(here("data", "models", "l1_sub_model.RDS"))
l2_mod <- read_rds(here("data", "models", "l2_sub_model.RDS"))
all_desc_df <- read.csv(here("data", "tidy", "all_desc.csv"))
stim_df <- read.csv(here("data", "tidy", "stim.csv"))
total_participants <- sum(participants$l2_subset_no, participants$non_l2_no, participants$dqed_no)
total_participants_q <- sum(participants$l2_subset_no, participants$non_l2_no)
all_df <- rbind(l1_df, l2_df)
all_part <- length(unique(all_df$participant))
temp_4 <- all_df %>%
filter(fr_eng_p > .05) %>%
filter(sp_eng_p < .05)
l2_subset <- unique(temp_4$participant)
non_l2_subset_df_fr <- l1_df %>%
filter(language == "french")
non_l2_subset_df_sp <- l1_df %>%
filter(language == "spanish")
bio_data <- read.csv(here("data", "tidy", "tidy_bio.csv"))
# load participants
participants <- read.csv(here::here("data", "tidy", "participant_count.csv"))
# load data
l1_df <- read.csv(here::here("data", "tidy", "non_l2_subset.csv"))
l2_df <- read.csv(here::here("data", "tidy", "l2_subset.csv"))
tidy_df <- rbind(l1_df, l2_df)
all_desc_df <- read.csv(here("data", "tidy", "all_desc.csv"))
# load models
mod0 <- readRDS(here("data", "models", "full_model.RDS"))
model1 <- readRDS(here("data", "models", "l2_sub_model.RDS"))
model2 <- readRDS(here("data", "models", "l1_sub_model.RDS"))
# load nested model comps
nmc_f <- read.csv(here("data", "tidy", "nmc_full.csv"))
nmc_l1 <- read.csv(here("data", "tidy", "nmc_l1.csv"))
nmc_l2 <- read.csv(here("data", "tidy", "nmc_l2.csv"))
# load r_squared df
r_dq_df <- read.csv(here("data", "tidy", "r_sq_df.csv"))
fm_2rm <- r_dq_df$R2m[1] %>% round(digits = 3)*100 # model full r2m
l2_r2m <- r_dq_df$R2m[2] %>% round(digits = 3)*100 # model l2 r2m
l1_r2m <- r_dq_df$R2m[3] %>% round(digits = 3)*100 # model l1 r2m
fm_2rc <- r_dq_df$R2c[1] %>% round(digits = 3)*100 # model full r2c
l2_r2c <- r_dq_df$R2c[2] %>% round(digits = 3)*100 # model l2 r2c
l1_r2c <- r_dq_df$R2c[3] %>% round(digits = 3)*100 # model l1 r2c
# make fixed effects a df
mod0_fix_ef <- fixef(mod0) %>%
as.data.frame() # full df
mod1_fix_ef <- fixef(model1) %>%
as.data.frame() # L2 subset
mod2_fix_ef <- fixef(model2) %>%
as.data.frame() # L1 subset
# full model effects
full_fr <- mod0_fix_ef$.[2] %>% round(digit = 2) # fr
full_sp <- mod0_fix_ef$.[3] %>% round(digit = 2) # sp
# l2 effects
l2_fr <- mod1_fix_ef$.[2] %>% round(digit = 2) # fr
l2_sp <- mod1_fix_ef$.[3] %>% round(digit = 2) # sp
# l1 effects
l1_fr <- mod2_fix_ef$.[2] %>% round(digit = 2) # fr
l1_sp <- mod2_fix_ef$.[3] %>% round(digit = 2) # sp
participants <- read.csv(here::here("data", "tidy", "participant_count.csv"))
total_participants <- sum(participants$l2_subset_no, participants$non_l2_no, participants$dqed_no)
total_participants_q <- sum(participants$l2_subset_no, participants$non_l2_no)
stim_df <- read.csv(here("data", "tidy", "stim.csv"))
power_df <- read.csv(here("data", "tidy", "powerdf.csv"))
dis_df <- read.csv(here("data", "tidy", "dis_df.csv"))
mono_data <- read.csv(here("data", "tidy", "mono_df.csv"))
stim_df
total_participants_q
l2_fr
l2_sp
